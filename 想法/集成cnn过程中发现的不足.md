# 集成CNN过程中发现的不足

+ 上传文件的问题：

  + 有些时候并不是只需要上传一个文件就够了，需要上传多个文件并对多个文件进行读取和赋值
    + 解决办法：
      + 1. 上传文件的地方多添加一个文件的上传选项，可以上传文件或者是直接上传文件的元数据
      + 2. 并且文件的上传可以改成上传数量没有限制的形式，并且上传的时候需要配置所上传文件的一些信息。

+ default配置的问题

  + 现在的参数是以list的形式存在一个列表里面，模块获取到之后根据调用顺序来确定参数的位置，这种方式不利于不同的模块开发，容易出错，并且调用顺序出错以后参数就会取错。
    + 解决办法
      + 1. 采用map的方式，每一个参数存入一个对象里面，对象里有其他属性能够描述清楚这是什么参数。（具体的描述参数还没搞清楚）
           1. 在每个模块返回的信息中，应该存在一些描述性的属性，描述当前模块返回的参数的信息

+ 如果项目中变量的引用很乱的话图上画出来的依赖线很多并且模块和别的项目的模块能够组合成功的成功率也不高

+ 配置文件（项目的一些配置）

  + 项目的配置可以分为初始化配置和每个节点的单个配置。初始化配置在每个节点调用的时候直接传到那个节点里面，每个节点的单独配置每个节点调用的时候直接传给指定的节点。

  

+ ⚠️ 如果在多台机器上分布式的部署计算端项目的话（在每个人的PC上集成的时候） 会出现文件上传到服务器的情况，这个时候就需要加一个文件传输的机制

  + 当本地集成运行的时候如果找不到上传的文件的话就去服务端通过http的方式下载这个文件

  + 具体的操作方式

    + 创建一个或者是几个文件中心，文件中心用来管理所有的文件，当每个计算端进行计算的时候都会去文件中心进行文件的下载
    + 下载完成文件之后才会进行响应的后续操作

  + 当前的模式

    + 所有的调度端服务（除了计算端之外）都部署到服务器上，当有人在集成项目的时候直接在本地启动一个计算端的项目，这个项目就会注册到注册中心，然后在流程图的前端上就可以使用这个项目的模块了，因此项目的集成同学就可以在集成的同时进行调试，同时计算端也可以实现分布式的部署。

    + 所带来的问题：上传文件只能上传到一个服务里面，其他的计算端的物理机上就没有这一个文件，就无法进行计算，因为计算结果在上一个节点里面，还没有传输到当前的节点里面

    + 解决办法：制作一个文件中心，所有的文件都保存到文件中心里面去，当某一个计算节点需要某一个文件的时候（如果本地没有）就去文件中心找到那个文件并进行下载。因为在设计元数据的格式的时候就指定了没个文件下载的url，因此就只需要在调度端传过来的元数据中解析到所需要文件的下载url并进行下载就行了。

    + 从流程图的流程开始走起

      1. 上传数据的时候就上传到文件中心，文件中心提供文件的上传下载服务。
      2. 此时进入第一个节点，第一个节点在本地进行文件查找，如果本地查找不到文件的话就去元数据提供的下载url进行下载。然后进行计算并把结果保存到当前节点中，并封装数据的元数据（内含url），如果下一个节点不在本机上的话，就使用当前节点提供的下载链接到当前机器进行下载。
      3. 因此文件中心现在的作用就仅仅是存储一开始上传的数据文件，其他的过程文件都是分布式的存储在每一个计算节点上的。

      

      











# 集成CNN过程中发现代码不合理并改进了的地方

+ 传入自定义adapter方法的时候有一段代码需要需要自己写上去，但是实际上可以把这段代码集成到系统中（循环遍历元数据文件并获取到数据地址逻辑） 此时用户需要写adapter方法就只需要接收一个数据文件地址，手写读取的代码并返回读取文件之后的对象即可

