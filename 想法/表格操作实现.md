# 20211228 关于表格操作的实现

## 操作队列的实现

在每一个文件进行处理的时候，系统自动为这个文件创建一个元数据文件，叫**操作队列**，每次有操作进来的时候都会在操作队列里面进行入队操作。

操作队列：每一次操作都会添加到队列里面，然后返回给前端，当用户点击提交的时候系统就会在后台异步的依次执行操作队列，直到为空。每次提交都会将队列里的操作全部处理完成。在提交之前用户可以执行撤回操作，撤回操作就是依次删除队尾的元素。执行就是在队首依次出队执行。

## 具体任务的分发和执行

+ 在每次执行操作之后前端都会向后台提交操作的描述
  + 这样做是为了保证前端和后台的操作同步，当前端出现问题的时候操作不会全部丢失，会有一部分存到了后台。
+ 在用户点击提交按钮的时候后台才会真正去执行操作，当执行操作开始后，队列立即被锁定，用户就不能够修改值，只有等操作完车之后才能够继续对数据进行处理。

## 操作

每一个处理步骤我们均称其为一个操作，每一个操作都是一个最小的处理单元，每一个处理单元都对应着一个具体的实现该操作的方法。当需要开始执行一个操作的时候只需要根据操作的描述找该操作对应的执行方法并调用即可。

## 操作处理器

​		需要引入操作处理器，所有的操作都在操作处理器当中进行操作的分发和结果的回收。操作是以一个顺序的方式输入到操作处理器，操作处理器依次对每一个操作执行操作的调度和装配。

​		每当一个操作进入操作处理器之后，操作处理器对操作对象进行解析，寻找出该操作对应的操作处理方法，找到方法之后将该操作进行解析（或者是直接将操作装入操作的执行方法中），当操作对应的方法执行完操作之后将操作的结果返回到操作处理器，此时就执行完了一次完整的操作。

 + 存在的值得思考的问题
   + 操作处理器应该是可以解析操作执行的某行列，动态的去扫描全队列的操作找到几个互不相关的操作同时去执行，然后将执行结果合并。  也就是调度的问题。
 + 操作装配的思考
   + 操作的装配采用一定的模式，能够动态的去选择对象进行装配。并且能够根据一定的接口规范动态的去添加执行模块而不影响别的模块。
   + 动态的添加操作模块，项目的热更新

## 操作执行状态监控

操作的执行步骤和执行状态都能够监控到。