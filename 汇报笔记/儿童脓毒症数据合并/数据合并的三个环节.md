# 数据合并的三个环节

## 	1.  确定id

  确定**就诊号**为数据合并的id和key

   从业务的角度来看：因为就诊号代表的是具体的一个病人在一次看病的过程中所产生的**唯一标识符**，能够代表这一次就诊

  从逻辑的角度来看：通过统计得知，就诊号这一列在数据中是不会在多个病人实例上重复出现的，一个就诊号就对应了一个病人。

## 2. 确定实例结构，数据结构

​		在**脓毒症呼吸机使用**、**脓毒症检验数据**、**脓毒症血管活性药物数据**这三张表中，有一部分特征数据是包含在列数据单元格中的，然后我们对数据格式的需求是一个患者的各种特征都展示在一行当中，因此我们需要将这三个表的数据进行一定的格式转换。大致格式如下表所示。同时还有的表所表示的是时间序列，如下表，同一个病人有两次相同的医嘱，但是两次相同的医嘱对应的开始日期和停止日期是不一样的，因此对于这一类的数据在进行行列转换的时候还需要进行特殊处理，以一个列表的形式存储不同时间点的信息。

| 就诊号   | 姓名   | 医嘱名               | 医嘱开始日期        | 医嘱停止日期        | 持续小时数 |
| -------- | ------ | -------------------- | ------------------- | ------------------- | ---------- |
| 50059032 | 肖千煜 | 无创辅助通气(PICU)   | 2019-11-07 10:19:00 | 2019-11-17 15:00:11 | 244.7      |
| 50059032 | 肖千煜 | 呼吸机辅助呼吸(PICU) | 2019-12-12 14:43:13 | 2019-12-14 12:00:00 | 45.3       |
| 50059032 | 肖千煜 | 无创辅助通气(PICU)   | 2019-12-14 12:00:08 | 2019-12-18 10:00:00 | 94.0       |
| 。。。   | 。。。 | 。。。               | 。。。              | 。。。              | 。。。     |

<span style="margin-left:20rem;size=10px">表2.1 部分 脓毒症呼吸机 使用表</span>

​		首先确定需要将列数据转换为行数据，再确定这些列数据有关的列是哪一些，是否为时间序列的数据。确定数据之后根据第一步确定的id将列数据全部转换为行数据。

​		转换之后的数据如下表所示，由于**无创辅助通气(PICU)**和**呼吸机辅助呼吸(PICU)**都是基于时间序列的数据（同一个病人在不同的时间可能会有两次该数据的统计）因此是以json列表的形式展现在表格里，如果当前病人没有指定的统计项的话，该项的值就为null。完成数据结构格式转换之后，一个患者所有的信息分布在四张不同的表当中，我们需要的是所有的信息是分布在同一张表当中。因此需要合并这四张表的数据，经过观察，这四张表当中都有数据项就诊号且就诊号是第一步确定的id，因此以就诊号为id进行合并操作，在合并过程中去除掉重复的数据列。合并操作具体实现是以就诊号为key，对四张表格进行横向的<u>全联接</u>合并，若有的数据项在多张表中都有，只是内容不一样，那么它们数据不相交的部分在全联接之后会以空值填充。合并之后的数据也如下表所示。

| 就诊号   | 姓名   | 无创辅助通气(PICU)                                           | 呼吸机辅助呼吸(PICU)                                         | 无创辅助通气 | 。。。 |
| -------- | ------ | ------------------------------------------------------------ | ------------------------------------------------------------ | ------------ | ------ |
| 50059032 | 肖千煜 | [{'医嘱开始日期': '2019-11-07 10:19:00', '医嘱停止日期': '2019-11-17 15:00:11', '持续小时数': 244.7}, {'医嘱开始日期': '2019-12-14 12:00:08', '医嘱停止日期': '2019-12-18 10:00:00', '持续小时数': 94.0}] | [{'医嘱开始日期': '2019-12-12 14:43:13', '医嘱停止日期': '2019-12-14 12:00:00', '持续小时数': 45.3}] | null         | 。。。 |
| 。。。   | 。。。 | 。。。                                                       | 。。。                                                       | 。。。       | 。。。 |

<span style="margin-left:20rem;size=10px">表2.2 部分 脓毒症呼吸机 使用表 格式转换后</span>

 

## 3. 确定标签

主要诊断描述

在数据中有**主要诊断描述**和**医生主要诊断描述**两列，从下图中可以看出，脓毒血症在主要诊断描述中只有一种描述方式，然后对应的医生主要诊断描述中就有着6种不同的描述，如果要将**医生主要诊断描述**属性作为标签的话还需要基于规则对这些数据进行统一，但是如果直接使用主要诊断描述，其内容则是规整统一的，不需要多一步骤的后续处理。因此选用**主要诊断描述**作为标签

| 主要诊断描述 | 医生主要诊断描述 |
| ------------ | ---------------- |
| 脓毒血症     | 1.脓毒症         |
| 脓毒血症     | 脓毒症           |
| 脓毒血症     | 严重脓毒症       |
| 脓毒血症     | 脓毒症伴血流感染 |
| 脓毒血症     | 败血症           |
| 脓毒血症     | 脓毒症伴血流感染 |

<span style="margin-left:20rem;size=10px">表3.1 部分合并后内容表</span>

